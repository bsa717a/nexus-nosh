(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(2355)}])},4212:function(e,t,a){"use strict";a.d(t,{VU:function(){return l},le:function(){return i}});var s=a(310),r=a(9724);let n="tasteProfiles";async function i(e){if(!s.Wn)return console.warn("Firebase not configured. Returning default profile."),{userId:e,preferences:{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},learningData:{totalRatings:0,averageRating:0,lastUpdated:new Date}};try{let t=(0,s.xI)(),a=(0,r.JU)(t,n,e),i=await (0,r.QT)(a);if(i.exists())return i.data();let l={userId:e,preferences:{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},learningData:{totalRatings:0,averageRating:0,lastUpdated:new Date}};return await (0,r.pl)(a,l),l}catch(e){return console.error("Error getting taste profile:",e),null}}async function l(e,t){if(console.log("[updateTasteProfile] Starting...",{userId:e,preferences:t}),!s.Wn)throw console.error("[updateTasteProfile] Firebase not configured!"),Error("Firebase is not configured");try{let i=(0,s.xI)(),l=(0,s.yL)(),o=(0,r.JU)(i,n,e);console.log("[updateTasteProfile] Document reference created:",o.path);let c=null;try{console.log("[updateTasteProfile] Attempting to read existing profile...");let e=await Promise.race([(0,r.QT)(o),new Promise((e,t)=>setTimeout(()=>t(Error("timeout")),2e3))]);e&&e.exists()?(c=e.data(),console.log("[updateTasteProfile] Found existing profile:",c)):console.log("[updateTasteProfile] No existing profile found")}catch(e){console.warn("[updateTasteProfile] Could not read existing profile (may be offline):",e.message)}let{Timestamp:d}=await Promise.resolve().then(a.bind(a,9724)),u={userId:e,preferences:{...(null==c?void 0:c.preferences)||{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},...t},learningData:{...(null==c?void 0:c.learningData)||{totalRatings:0,averageRating:0},lastUpdated:d.now()}};if(!l||!l.currentUser)throw Error("User must be authenticated to save taste profile");console.log("[updateTasteProfile] User authenticated:",l.currentUser.uid),console.log("[updateTasteProfile] Saving data:",u),console.log("[updateTasteProfile] Attempting setDoc with merge..."),await Promise.race([(0,r.pl)(o,u,{merge:!0}),new Promise((e,t)=>setTimeout(()=>t(Error("Write operation timed out after 30 seconds")),3e4))]),console.log("[updateTasteProfile] ✓ Successfully saved to Firebase!")}catch(e){var i;if(console.error("[updateTasteProfile] ✗ Full error object:",e),console.error("[updateTasteProfile] ✗ Error as JSON:",JSON.stringify(e,Object.getOwnPropertyNames(e),2)),console.error("[updateTasteProfile] ✗ Error details:",{message:e.message,code:e.code,serverResponse:e.serverResponse,name:e.name,stack:null===(i=e.stack)||void 0===i?void 0:i.substring(0,500)}),"permission-denied"===e.code||"PERMISSION_DENIED"===e.code)throw Error("Permission denied. Please ensure you are logged in and have permission to save this data.");if("unauthenticated"===e.code||"UNAUTHENTICATED"===e.code)throw Error("Authentication required. Please sign in and try again.");if("invalid-argument"===e.code||"INVALID_ARGUMENT"===e.code)throw Error("Invalid data format. Please check the data being saved.");if("unavailable"===e.code||"UNAVAILABLE"===e.code)throw Error("Firestore is currently unavailable. Please try again in a moment.");else if(e.message&&e.message.includes("timed out"))throw console.warn("[updateTasteProfile] Write timed out - may complete in background if online"),Error("Save operation timed out. Please check your connection and try again.");throw Error("Failed to save: ".concat(e.message||e.code||"Unknown error"))}}},245:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1462).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},9967:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1462).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8154:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(1462).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},2355:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return _}});var s=a(5893),r=a(9008),n=a.n(r),i=a(7294),l=a(1163),o=a(9767),c=a(2691),d=a(1462);let u=(0,d.Z)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);var m=a(5677),h=a(7963),x=a(245);let g=(0,d.Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);var p=a(898),f=a(6510),v=a(6314),y=a(310),b=a(9724),j=a(4212);async function w(e,t,a){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;if(!y.Wn||!y.db)return console.warn("[getPersonalizedRecommendations] Firebase not configured. Returning empty recommendations."),[];try{console.log("[getPersonalizedRecommendations] Starting for user:",e);let r=await (0,j.le)(e);console.log("[getPersonalizedRecommendations] Profile:",r);let n={userId:e,preferences:{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},learningData:{totalRatings:0,averageRating:0,lastUpdated:new Date}},i=r||n;console.log("[getPersonalizedRecommendations] Using profile:",i);let l=[];try{let t=(0,b.IO)((0,b.hJ)(y.db,"ratings"),(0,b.ar)("userId","==",e),(0,b.Xo)("rating","desc"),(0,b.b9)(10));l=(await (0,b.PL)(t)).docs.filter(e=>e.data().rating>=4).map(e=>e.data().restaurantId)}catch(e){console.warn("[getPersonalizedRecommendations] Could not fetch ratings (may need index):",e)}let o=[];try{let t=(0,b.IO)((0,b.hJ)(y.db,"friendRecommendations"),(0,b.ar)("toUserId","==",e));o=(await (0,b.PL)(t)).docs.map(e=>e.data().restaurantId)}catch(e){console.warn("[getPersonalizedRecommendations] Could not fetch friend recommendations:",e)}console.log("[getPersonalizedRecommendations] Fetching restaurants from Firestore...");let c=(0,b.IO)((0,b.hJ)(y.db,"restaurants"),(0,b.b9)(100)),d=await (0,b.PL)(c);console.log("[getPersonalizedRecommendations] Found",d.docs.length,"restaurants");let u=d.docs.map(e=>({id:e.id,...e.data()}));console.log("[getPersonalizedRecommendations] Restaurants:",u.map(e=>e.name));let m=u.map(e=>{var s,r,n,c;let d=0,u=[],m="smart-match";l.includes(e.id)&&(d+=50,u.push("One of your favorites"),m="personal-favorite"),o.includes(e.id)&&(d+=40,u.push("Recommended by friends"),m="friend-recommendation");let h=i.preferences,x=e.attributes;if((null==x?void 0:x.quietness)!==void 0&&20>Math.abs(h.quietness-x.quietness)&&(d+=15,u.push("Matches your preference for quietness")),(null===(s=e.priceRange)||void 0===s?void 0:s.min)!==void 0&&(null===(r=e.priceRange)||void 0===r?void 0:r.max)!==void 0){let t=(e.priceRange.min+e.priceRange.max)/2;t>=h.priceRange.min&&t<=h.priceRange.max&&(d+=10,u.push("Within your price range"))}if(e.cuisineType.some(e=>h.cuisineTypes.includes(e))&&(d+=10,u.push("Matches your cuisine preferences")),a&&(null==x?void 0:null===(n=x.idealMeetingTypes)||void 0===n?void 0:n.includes(a))&&(d+=20,u.push("Perfect for ".concat(a.replace("-"," ")))),t){let a=function(e,t,a,s){let r=(a-e)*Math.PI/180,n=(s-t)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}(t.lat,t.lng,e.coordinates.lat,e.coordinates.lng);a<1?(d+=15,u.push("Very close to you")):a<5&&(d+=10,u.push("Nearby"))}return(null===(c=e.rating)||void 0===c?void 0:c.average)!==void 0&&e.rating.average>=4&&(d+=10,u.push("Highly rated")),0===u.length&&(u.push("Great option in St. George"),d+=5),{restaurant:e,score:d,reasons:u.slice(0,3),matchType:m}}).sort((e,t)=>{var a,s;return(null!==(a=t.score)&&void 0!==a?a:0)-(null!==(s=e.score)&&void 0!==s?s:0)}).slice(0,s);return console.log("[getPersonalizedRecommendations] Returning",m.length,"recommendations"),m}catch(e){return console.error("[getPersonalizedRecommendations] Error getting recommendations:",e),[]}}var N=a(7816),k=a(3876),P=a(4027),M=a(3949),E=a(5793),R=a(9211),S=a(1526),C=a(9455),T=a(8154);let I=(0,d.Z)("volume-2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]),z=(0,d.Z)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);var D=a(1692);let Z=(0,d.Z)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var A=a(7218),F=a(9967);function U(e){var t,a,r,n;let{isOpen:l,onClose:d,restaurant:x}=e,[g,p]=(0,i.useState)(null),[f,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{l&&x&&(x.aiSummary?(p(x.aiSummary),y(!1)):(p(null),b(x)))},[l,x]);let b=async e=>{y(!0);try{let t=await fetch("/api/enrich-restaurant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({restaurantName:e.name,restaurantAddress:e.address,restaurantId:e.id})});if(t.ok){let e=await t.json();p(e)}}catch(e){console.error("Failed to fetch AI summary",e)}finally{y(!1)}};if(!x)return null;let j=x.priceRange?"$".repeat(Math.ceil(x.priceRange.max/30)):(null==g?void 0:g.priceBucket)||"$$";return(0,s.jsx)(S.M,{children:l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(v.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,className:"fixed inset-0 bg-black/60 z-50 backdrop-blur-sm"}),(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none",children:(0,s.jsxs)(v.E.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",duration:.5},className:"w-full max-w-2xl max-h-[85vh] bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col pointer-events-auto",children:[(0,s.jsxs)("div",{className:"h-24 bg-gradient-to-br from-orange-400 to-rose-500 relative shrink-0",children:[x.imageUrl?(0,s.jsx)("img",{src:x.imageUrl,alt:x.name,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-white rounded-full shadow-lg border-2 border-blue-100 flex items-center justify-center",children:(0,s.jsx)(C.Z,{className:"w-6 h-6 text-blue-500"})})}),(0,s.jsx)("button",{onClick:d,className:"absolute top-4 right-4 w-10 h-10 bg-black/20 hover:bg-black/40 backdrop-blur-md rounded-full flex items-center justify-center text-white transition-colors",children:(0,s.jsx)(T.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"overflow-y-auto flex-1 p-6 md:p-8 custom-scrollbar",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:x.name}),(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-yellow-50 px-3 py-1 rounded-full",children:[(0,s.jsx)(c.Z,{className:"w-5 h-5 fill-yellow-500 text-yellow-500"}),(0,s.jsx)("span",{className:"font-bold text-gray-900",children:(null===(a=x.rating)||void 0===a?void 0:null===(t=a.average)||void 0===t?void 0:t.toFixed(1))||"New"}),(null===(r=x.rating)||void 0===r?void 0:r.count)&&(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["(",x.rating.count,")"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mb-6",children:[x.cuisineType.map(e=>(0,s.jsx)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium",children:e},e)),(0,s.jsx)("span",{className:"px-3 py-1 bg-green-50 text-green-700 rounded-full text-sm font-medium",children:j})]}),(0,s.jsxs)("div",{className:"mb-8 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-5 border border-indigo-100 relative overflow-hidden",children:[(0,s.jsxs)("div",{className:"absolute top-0 right-0 bg-indigo-100 px-2 py-1 rounded-bl-lg text-[10px] font-bold text-indigo-800 flex items-center gap-1",children:[(0,s.jsx)(u,{className:"w-3 h-3"}),"AI RESEARCH"]}),f?(0,s.jsxs)("div",{className:"flex items-center gap-3 py-4",children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"}),(0,s.jsx)("span",{className:"text-indigo-600 font-medium text-sm",children:"Analyzing reviews & vibe..."})]}):g?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("p",{className:"text-indigo-900 font-medium text-lg leading-snug",children:['"',g.vibeDescription,'"']}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white/60 rounded-xl p-3",children:[(0,s.jsx)("div",{className:"text-xs text-indigo-500 font-bold uppercase mb-1",children:"Popular Dishes"}),(0,s.jsx)("ul",{className:"text-sm text-gray-700 space-y-1",children:null===(n=g.popularDishes)||void 0===n?void 0:n.slice(0,3).map(e=>(0,s.jsxs)("li",{className:"flex items-start gap-1.5",children:[(0,s.jsx)("span",{className:"text-indigo-400 mt-1",children:"•"}),e]},e))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between bg-white/60 rounded-lg px-3 py-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-600 text-sm",children:[(0,s.jsx)(I,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Quietness"})]}),(0,s.jsxs)("span",{className:"font-bold ".concat(g.quietness>70?"text-green-600":g.quietness<40?"text-red-500":"text-yellow-600"),children:[g.quietness,"%"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[g.goodForBusiness&&(0,s.jsx)("div",{className:"flex-1 bg-white/60 rounded-lg p-2 flex justify-center",title:"Good for Business",children:(0,s.jsx)(z,{className:"w-4 h-4 text-blue-600"})}),g.goodForDates&&(0,s.jsx)("div",{className:"flex-1 bg-white/60 rounded-lg p-2 flex justify-center",title:"Good for Dates",children:(0,s.jsx)(D.Z,{className:"w-4 h-4 text-rose-500"})}),g.goodForGroups&&(0,s.jsx)("div",{className:"flex-1 bg-white/60 rounded-lg p-2 flex justify-center",title:"Good for Groups",children:(0,s.jsx)(h.Z,{className:"w-4 h-4 text-orange-500"})})]})]})]})]}):(0,s.jsx)("p",{className:"text-sm text-gray-500 italic",children:"AI insights unavailable for this location."})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(x.website||(null==g?void 0:g.websiteUrl)||(null==g?void 0:g.menuUrl))&&(0,s.jsx)("a",{href:(null==g?void 0:g.menuUrl)||(null==g?void 0:g.websiteUrl)||x.website,target:"_blank",rel:"noopener noreferrer",className:"w-full",children:(0,s.jsxs)(o.z,{className:"w-full bg-orange-500 hover:bg-orange-600 text-white gap-2",children:[(0,s.jsx)(Z,{className:"w-4 h-4"}),(null==g?void 0:g.menuUrl)?"View Menu":"Visit Website"]})}),(0,s.jsx)("a",{href:"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent(x.address)),target:"_blank",rel:"noopener noreferrer",className:"w-full",children:(0,s.jsxs)(o.z,{variant:"outline",className:"w-full gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4"}),"Get Directions"]})}),(0,s.jsx)("div",{className:"w-full flex justify-center",children:(0,s.jsx)(R.Z,{restaurantId:x.id,restaurant:x,showLabel:!0,className:"w-full justify-center bg-gray-100 hover:bg-gray-200 text-gray-700 border-0"})})]})}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-2xl p-5",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Details"}),(0,s.jsxs)("div",{className:"space-y-3 text-sm text-gray-600",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mt-0.5 text-gray-400"}),(0,s.jsx)("p",{children:x.address})]}),x.attributes&&(0,s.jsxs)(s.Fragment,{children:[x.attributes.atmosphere&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-4 flex justify-center",children:(0,s.jsx)("span",{className:"text-gray-400",children:"•"})}),(0,s.jsxs)("span",{className:"capitalize",children:["Atmosphere: ",x.attributes.atmosphere]})]}),x.attributes.serviceSpeed&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-4 flex justify-center",children:(0,s.jsx)(A.Z,{className:"w-4 h-4 text-gray-400"})}),(0,s.jsxs)("span",{className:"capitalize",children:["Service: ",x.attributes.serviceSpeed]})]}),x.attributes.privateBooths&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(F.Z,{className:"w-4 h-4 text-green-500"}),(0,s.jsx)("span",{children:"Private Booths Available"})]})]})]})]})]})]})]})})]})})}function L(e){var t,a,r,n,d,y;let{userId:b,userLocation:S,userName:C="Derek"}=e,T=(0,l.useRouter)(),I=(0,i.useRef)(null),z=(0,i.useRef)(null),[D,Z]=(0,i.useState)([]),[A,F]=(0,i.useState)([]),[L,q]=(0,i.useState)([]),[O,G]=(0,i.useState)([]),[_,B]=(0,i.useState)(!0),[V,$]=(0,i.useState)(null),[H,W]=(0,i.useState)(""),[J,Q]=(0,i.useState)(S),[Y,X]=(0,i.useState)(!0),[K,ee]=(0,i.useState)([]),[et,ea]=(0,i.useState)(null),[es,er]=(0,i.useState)(!1),[en,ei]=(0,i.useState)(!1),[el,eo]=(0,i.useState)(null),[ec,ed]=(0,i.useState)(""),[eu,em]=(0,i.useState)(!1),[eh,ex]=(0,i.useState)(null),[eg,ep]=(0,i.useState)([]),[ef,ev]=(0,i.useState)(new Set),[ey,eb]=(0,i.useState)(new Set),ej=(0,i.useRef)(null),ew=(0,i.useRef)(null),[eN,ek]=(0,i.useState)(!1),[eP,eM]=(0,i.useState)(null),eE=(0,i.useCallback)(async()=>{B(!0);try{let[e,t,a,s,r,n]=await Promise.all([w(b,S),(0,j.le)(b),(0,N.GY)(100),(0,M.VH)(b,2),(0,k.j8)(b),(0,M.MC)(b)]);if(Z(e),F(e),$(t),q(a),ep(s),ev(new Set(r)),eb(new Set(n)),S){let e=await (0,P.Y2)(S,1e4,25);G(e),ea(S)}}catch(e){console.error("[Dashboard] Error loading data:",e)}finally{B(!1)}},[b,S]);(0,i.useEffect)(()=>{eE()},[eE]),(0,i.useEffect)(()=>{(O.length>0||A.length>0)&&Z(Array.from(new Map([...A,...O.map(e=>({restaurant:e,matchScore:70+Math.floor(26*Math.random()),matchType:"smart-match",reasons:["Popular in this area","Matches your location context"]}))].map(e=>[e.restaurant.id,e])).values()).sort(()=>Math.random()-.5).slice(0,10))},[O,A]),(0,i.useEffect)(()=>{S&&Q(S)},[S]);let eR=(0,i.useCallback)(async e=>{Y&&(et&&2>eS(et.lat,et.lng,e.lat,e.lng)||(ej.current&&clearTimeout(ej.current),ej.current=setTimeout(async()=>{er(!0);try{let t=await (0,P.Y2)(e,1e4,25);G(e=>{let a=new Set(e.map(e=>e.id)),s=t.filter(e=>!a.has(e.id));return[...e,...s]}),ea(e)}catch(e){console.error("[Dashboard] Error loading Mapbox restaurants for new area:",e)}finally{er(!1)}},500)))},[Y,et]);(0,i.useEffect)(()=>()=>{ej.current&&clearTimeout(ej.current)},[]);let eS=(e,t,a,s)=>{let r=(a-e)*Math.PI/180,n=(s-t)*Math.PI/180,i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371},eC=(0,i.useMemo)(()=>{let e=new Map;return L.forEach(t=>{var a,s;if((null==t?void 0:t.name)&&(null==t?void 0:null===(a=t.coordinates)||void 0===a?void 0:a.lat)&&(null==t?void 0:null===(s=t.coordinates)||void 0===s?void 0:s.lng)){let a="".concat(t.name.toLowerCase(),"-").concat(t.coordinates.lat.toFixed(4),"-").concat(t.coordinates.lng.toFixed(4));e.set(a,{...t,source:"database"})}}),D.forEach(t=>{var a,s;let r=null==t?void 0:t.restaurant;if((null==r?void 0:r.name)&&(null==r?void 0:null===(a=r.coordinates)||void 0===a?void 0:a.lat)&&(null==r?void 0:null===(s=r.coordinates)||void 0===s?void 0:s.lng)){let t="".concat(r.name.toLowerCase(),"-").concat(r.coordinates.lat.toFixed(4),"-").concat(r.coordinates.lng.toFixed(4));e.has(t)||e.set(t,r)}}),Y&&O.forEach(t=>{var a,s;if((null==t?void 0:t.name)&&(null==t?void 0:null===(a=t.coordinates)||void 0===a?void 0:a.lat)&&(null==t?void 0:null===(s=t.coordinates)||void 0===s?void 0:s.lng)){let a="".concat(t.name.toLowerCase(),"-").concat(t.coordinates.lat.toFixed(4),"-").concat(t.coordinates.lng.toFixed(4)),s=e.get(a);s?e.set(a,{...s,id:t.id,name:t.name,address:t.address,coordinates:t.coordinates,source:"mapbox"}):e.set(a,t)}}),Array.from(e.values())},[L,O,Y,D]),eT=(0,i.useMemo)(()=>{let e=eC,t=el?eC.find(e=>e.id===el):null;return H.trim()&&(e=e.filter(e=>{var t;return null==e?void 0:null===(t=e.address)||void 0===t?void 0:t.includes(H.trim())})),t&&!e.find(e=>e.id===t.id)&&(e=[t,...e]),S&&e.length>0&&(e=[...e].sort((e,t)=>eS(S.lat,S.lng,e.coordinates.lat,e.coordinates.lng)-eS(S.lat,S.lng,t.coordinates.lat,t.coordinates.lng))),e},[eC,H,S,el]),eI=()=>{let e=new Date;return 1e4*e.getFullYear()+(e.getMonth()+1)*100+e.getDate()},ez=new Set,eD=D.filter(e=>!ez.has(e.restaurant.id)&&(ez.add(e.restaurant.id),!0)).filter(e=>{var t;return null==e?void 0:null===(t=e.restaurant)||void 0===t?void 0:t.name}).map(e=>{var t;return{...e,adjustedScore:(e.matchScore||e.score||0)+(eI()%((null===(t=e.restaurant.name)||void 0===t?void 0:t.length)||1)-2.5)}}).sort((e,t)=>t.adjustedScore-e.adjustedScore).slice(0,3),eZ=e=>{var t,a;let s=(null===(t=D.find(t=>t.restaurant.id===e))||void 0===t?void 0:t.restaurant)||L.find(t=>t.id===e)||O.find(t=>t.id===e);if(s){null===(a=z.current)||void 0===a||a.scrollIntoView({behavior:"smooth",block:"center"});let t=eT.find(t=>t.id===e);t||(t=eT.find(e=>1e-4>Math.abs(e.coordinates.lat-s.coordinates.lat)&&1e-4>Math.abs(e.coordinates.lng-s.coordinates.lng)));let r=t?t.id:e;if(t&&I.current){I.current.focusRestaurant(r);return}eo(r),H.trim()&&!s.address.includes(H.trim())&&W(""),Q({lat:s.coordinates.lat,lng:s.coordinates.lng}),setTimeout(()=>{eo(null)},1e4)}},eA=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{Q({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("[Dashboard] Error getting current location:",e),alert("Could not get your location. Please enable location services.")},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):alert("Geolocation is not supported by your browser")},eF=(0,i.useCallback)(async e=>{W(e),ew.current&&clearTimeout(ew.current);let t=e.trim();t.length<5||(ew.current=setTimeout(async()=>{ei(!0);try{let e=await (0,P.$y)(t);if(e){Q(e),G([]),ea(null),er(!0);let t=await (0,P.Y2)(e,1e4,25);G(t),ea(e),er(!1)}}catch(e){console.error("[Dashboard] Error geocoding ZIP code:",e)}finally{ei(!1)}},600))},[]),eU=(0,i.useCallback)(async()=>{if(console.log("[Dashboard] handleRestaurantSearch called",{restaurantSearchQuery:ec}),!ec.trim()){console.log("[Dashboard] Search query is empty, returning"),ex(null);return}console.log("[Dashboard] Starting search..."),em(!0),ex(null);try{console.log("[Dashboard] Starting restaurant search:",{query:ec,location:J||S});let t=await (0,P.Mw)(ec,J||S,10);if(console.log("[Dashboard] Search results:",t.length,t),t.length>0){var e;console.log("[Dashboard] Setting search results:",t.length,"restaurants"),G(t),X(!0),(null===(e=t[0])||void 0===e?void 0:e.coordinates)&&(console.log("[Dashboard] Centering map on:",t[0].coordinates),Q(t[0].coordinates)),ex(null)}else console.log("[Dashboard] No search results found"),ex('No restaurants found for "'.concat(ec,'"'))}catch(e){console.error("[Dashboard] Error searching restaurants:",e),ex("Error searching restaurants. Please try again.")}finally{em(!1)}},[ec,J,S]);(0,i.useEffect)(()=>()=>{ew.current&&clearTimeout(ew.current)},[]),(0,i.useEffect)(()=>{if(el&&I.current){let t=eT.find(e=>e.id===el);if(!t){var e;let a=(null===(e=D.find(e=>e.restaurant.id===el))||void 0===e?void 0:e.restaurant)||L.find(e=>e.id===el)||O.find(e=>e.id===el);a&&(t=eT.find(e=>1e-4>Math.abs(e.coordinates.lat-a.coordinates.lat)&&1e-4>Math.abs(e.coordinates.lng-a.coordinates.lng)))}if(t){let e=setTimeout(()=>{I.current&&I.current.focusRestaurant(t.id)},300);return()=>clearTimeout(e)}}},[el,eT,D,L,O]);let eL=eD[0],eq=e=>{eM(e),ek(!0)};return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 pb-24",children:[(0,s.jsxs)(v.E.header,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"pt-8 pb-4 px-6",children:[(0,s.jsxs)("p",{className:"text-gray-500 text-sm font-medium",children:[(()=>{let e=new Date().getHours();return e<12?"Good morning":e<17?"Good afternoon":"Good evening"})(),", ",C]}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Ready for lunch?"})]}),(0,s.jsxs)("div",{className:"px-6 mb-6 grid md:grid-cols-2 gap-6",children:[(0,s.jsx)(v.E.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"h-full",children:_?(0,s.jsxs)("div",{className:"bg-white rounded-3xl p-6 shadow-lg shadow-orange-100/50 animate-pulse h-full",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-24 mb-4"}),(0,s.jsx)("div",{className:"h-8 bg-gray-200 rounded w-3/4 mb-3"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-6"}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("div",{className:"h-12 bg-gray-200 rounded-xl flex-1"}),(0,s.jsx)("div",{className:"h-12 bg-gray-200 rounded-xl flex-1"})]})]}):eL?(0,s.jsx)("div",{className:"bg-white rounded-3xl p-6 shadow-lg shadow-orange-100/50 border border-orange-100/50 h-full flex flex-col justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsxs)("span",{className:"bg-gradient-to-r from-orange-500 to-rose-500 text-white text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1",children:[(0,s.jsx)(c.Z,{className:"w-3 h-3 fill-white"}),"TOP PICK"]}),eL.matchScore&&(0,s.jsxs)("span",{className:"text-xs text-gray-400",children:[Math.round(eL.matchScore),"% match"]})]}),(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-1",children:[(0,s.jsx)("h2",{onClick:()=>{var e;return(null==eL?void 0:null===(e=eL.restaurant)||void 0===e?void 0:e.id)&&eZ(eL.restaurant.id)},className:"text-2xl font-bold text-gray-900 cursor-pointer hover:text-orange-500 transition-colors flex-1",children:(null==eL?void 0:null===(t=eL.restaurant)||void 0===t?void 0:t.name)||"Restaurant"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),(null==eL?void 0:eL.restaurant)&&eq(eL.restaurant)},className:"text-sm text-orange-500 font-medium hover:underline px-2 py-1",children:"More"}),(null==eL?void 0:null===(a=eL.restaurant)||void 0===a?void 0:a.id)&&(0,s.jsx)(R.Z,{restaurantId:eL.restaurant.id,restaurant:eL.restaurant,size:"sm"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500 mb-3",children:[(0,s.jsx)("span",{children:(null==eL?void 0:null===(r=eL.restaurant)||void 0===r?void 0:r.cuisineType)&&Array.isArray(eL.restaurant.cuisineType)?eL.restaurant.cuisineType.slice(0,2).join(" • "):"Restaurant"}),(null==eL?void 0:null===(d=eL.restaurant)||void 0===d?void 0:null===(n=d.priceRange)||void 0===n?void 0:n.max)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:"$".repeat(Math.ceil(eL.restaurant.priceRange.max/30))})]})]}),(0,s.jsx)("p",{className:"text-gray-600 mb-5 leading-relaxed",children:(null==eL?void 0:null===(y=eL.reasons)||void 0===y?void 0:y[0])||"Perfect match for your taste preferences"})]})}):(0,s.jsxs)("div",{className:"bg-white rounded-3xl p-6 shadow-lg shadow-orange-100/50 text-center h-full flex flex-col justify-center items-center",children:[(0,s.jsx)(u,{className:"w-12 h-12 text-orange-300 mx-auto mb-3"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No recommendations yet"}),(0,s.jsx)("p",{className:"text-gray-500 text-sm mb-4",children:"Explore the map and rate some restaurants to get personalized picks!"}),(0,s.jsxs)(o.z,{onClick:eA,className:"bg-orange-500 hover:bg-orange-600 text-white rounded-xl px-6",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Find Nearby"]})]})}),(0,s.jsxs)(v.E.section,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.2},className:"flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide flex items-center gap-2",children:[(0,s.jsx)(h.Z,{className:"w-4 h-4"}),"More for you"]}),(0,s.jsxs)("button",{onClick:()=>T.push("/friends"),className:"text-orange-500 text-sm font-medium flex items-center hover:text-orange-600",children:["See all ",(0,s.jsx)(x.Z,{className:"w-4 h-4"})]})]}),!_&&eg.length>0?(0,s.jsx)("div",{className:"space-y-3 overflow-y-auto max-h-[320px] pr-2 custom-scrollbar",children:eg.map((e,t)=>{var a,r,n;return(null==e?void 0:null===(a=e.restaurant)||void 0===a?void 0:a.id)&&(null==e?void 0:null===(r=e.restaurant)||void 0===r?void 0:r.name)?(0,s.jsx)("div",{onClick:()=>eZ(e.restaurant.id),className:"bg-white rounded-2xl p-4 shadow-sm shadow-gray-100/50 border border-gray-100 cursor-pointer hover:shadow-md transition-all group",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-800 text-sm truncate mb-0.5 group-hover:text-orange-600 transition-colors",children:e.restaurant.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:[(0,s.jsx)("span",{className:"truncate max-w-[120px]",children:(null===(n=e.restaurant.cuisineType)||void 0===n?void 0:n[0])||"Restaurant"}),(0,s.jsxs)("div",{className:"flex items-center gap-0.5 text-yellow-500",children:[(0,s.jsx)(c.Z,{className:"w-3 h-3 fill-yellow-500"}),(0,s.jsx)("span",{className:"font-medium",children:e.rating})]})]}),(0,s.jsxs)("p",{className:"text-xs text-indigo-600 font-medium",children:[e.friendName," likes this"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{onClick:()=>eq(e.restaurant),className:"text-xs text-gray-400 hover:text-orange-500 font-medium",children:"More"}),(0,s.jsx)(R.Z,{restaurantId:e.restaurant.id,restaurant:e.restaurant,size:"sm"}),(0,s.jsx)(x.Z,{className:"w-5 h-5 text-gray-300 group-hover:text-orange-400 transition-colors flex-shrink-0"})]})]})},"".concat(e.restaurant.id,"-").concat(t)):null})}):!_&&eD.length>1?(0,s.jsx)("div",{className:"space-y-3 overflow-y-auto max-h-[320px] pr-2 custom-scrollbar",children:eD.slice(1).map((e,t)=>{var a,r,n;return(null==e?void 0:null===(a=e.restaurant)||void 0===a?void 0:a.id)&&(null==e?void 0:null===(r=e.restaurant)||void 0===r?void 0:r.name)?(0,s.jsxs)("div",{onClick:()=>eZ(e.restaurant.id),className:"bg-white rounded-2xl p-4 shadow-sm shadow-gray-100/50 border border-gray-100 cursor-pointer hover:shadow-md transition-all flex items-center justify-between group",children:[(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-800 text-sm truncate mb-0.5 group-hover:text-orange-600 transition-colors",children:e.restaurant.name}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,s.jsx)("span",{className:"truncate max-w-[120px]",children:(null===(n=e.restaurant.cuisineType)||void 0===n?void 0:n[0])||"Restaurant"}),e.matchScore&&(0,s.jsxs)("span",{className:"font-medium text-orange-500 bg-orange-50 px-1.5 py-0.5 rounded-full",children:[Math.round(e.matchScore),"% match"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)(R.Z,{restaurantId:e.restaurant.id,restaurant:e.restaurant,size:"sm"}),(0,s.jsx)(x.Z,{className:"w-5 h-5 text-gray-300 group-hover:text-orange-400 transition-colors flex-shrink-0"})]})]},"".concat(e.restaurant.id,"-").concat(t)):null})}):(0,s.jsxs)("div",{className:"bg-white/50 rounded-2xl p-8 text-center border border-dashed border-gray-200 flex flex-col items-center justify-center h-full",children:[(0,s.jsx)(h.Z,{className:"w-8 h-8 text-gray-300 mb-2"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:"Add friends to see their favorite restaurants"}),(0,s.jsx)("button",{onClick:()=>T.push("/friends"),className:"mt-2 text-orange-500 text-sm font-medium hover:text-orange-600",children:"Add Friends"})]})]})]}),(0,s.jsx)(v.E.section,{ref:z,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3},className:"px-6",children:(0,s.jsxs)("div",{className:"bg-white rounded-3xl shadow-lg shadow-gray-100/50 overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-800",children:"Explore Nearby"}),(0,s.jsxs)(o.z,{onClick:()=>{if(D.length>0){let e=Math.floor(Math.random()*Math.min(D.length,10)),t=D[e];t&&eZ(t.restaurant.id)}},size:"sm",className:"bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-600 hover:to-rose-600 text-white rounded-lg text-xs px-3 py-1 whitespace-nowrap inline-flex items-center gap-1",children:[(0,s.jsx)(u,{className:"w-3 h-3 flex-shrink-0"}),(0,s.jsx)("span",{children:"Surprise Me"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)("div",{className:"relative flex items-center gap-1",children:[(0,s.jsx)(o.z,{variant:"outline",size:"sm",onClick:e=>{if(e.preventDefault(),e.stopPropagation(),console.log("[Dashboard] Search button clicked",{query:ec,disabled:eu||!ec.trim()}),!ec.trim()){alert("Please enter a search query");return}eU()},disabled:eu||!ec.trim(),className:"rounded-lg border-gray-200 flex-shrink-0",title:"Search restaurants",children:eu?(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-orange-500 border-t-transparent"}):(0,s.jsx)(g,{className:"w-4 h-4"})}),(0,s.jsx)("input",{type:"text",placeholder:"Search restaurants...",value:ec,onChange:e=>{ed(e.target.value),ex(null)},onKeyDown:e=>{"Enter"===e.key&&ec.trim()&&eU()},className:"w-32 px-3 py-1.5 text-sm bg-gray-50 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",placeholder:"ZIP",value:H,onChange:e=>eF(e.target.value),className:"w-20 px-3 py-1.5 text-sm bg-gray-50 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),en&&(0,s.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-2 border-orange-500 border-t-transparent"})})]}),(0,s.jsx)(o.z,{variant:"outline",size:"sm",onClick:eA,className:"rounded-lg border-gray-200",children:(0,s.jsx)(p.Z,{className:"w-4 h-4"})}),(0,s.jsx)(o.z,{size:"sm",onClick:()=>X(!Y),className:"rounded-lg ".concat(Y?"bg-orange-500 hover:bg-orange-600 text-white":"bg-gray-100 text-gray-600"),children:Y?"All":"Saved"})]})]}),eh&&(0,s.jsx)("div",{className:"text-xs text-orange-600 mt-1",children:eh})]}),(0,s.jsxs)("div",{className:"relative h-[400px]",children:[(0,s.jsx)(E.Z,{ref:I,restaurants:eT,center:J||{lat:37.0965,lng:-113.5684},userLocation:S,myListIds:ef,friendsListIds:ey,height:"100%",onBoundsChange:ee,onCenterChange:eR,onRestaurantInfoClick:eq}),es&&(0,s.jsxs)("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 bg-white/95 px-4 py-2 rounded-full shadow-lg flex items-center gap-2 z-10",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-orange-500 border-t-transparent"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Finding restaurants..."})]})]}),(0,s.jsx)("div",{className:"max-h-[200px] overflow-y-auto",children:K.length>0?(0,s.jsx)("div",{className:"divide-y divide-gray-50",children:K.slice(0,5).map(e=>{var t,a;return(null==e?void 0:e.id)&&(null==e?void 0:e.name)?(0,s.jsxs)("div",{onClick:()=>eZ(e.id),className:"flex items-center justify-between p-4 hover:bg-orange-50/50 cursor-pointer transition-colors",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-gray-800 truncate",children:e.name}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 truncate",children:[(null===(t=e.cuisineType)||void 0===t?void 0:t[0])||"Restaurant",(null===(a=e.attributes)||void 0===a?void 0:a.atmosphere)&&" • ".concat(e.attributes.atmosphere)]})]}),(0,s.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,s.jsx)(R.Z,{restaurantId:e.id,restaurant:e,size:"sm"})})]},e.id):null})}):(0,s.jsx)("div",{className:"text-center py-8 text-gray-400",children:(0,s.jsx)("p",{className:"text-sm",children:"Move the map to discover restaurants"})})})]})}),(0,s.jsx)(f.Z,{}),(0,s.jsx)(U,{isOpen:eN,onClose:()=>ek(!1),restaurant:eP})]})}var q=a(5993),O=a(6442);function G(){var e;let{user:t}=(0,O.a)(),[a,r]=(0,i.useState)(),[l,o]=(0,i.useState)(null);return((0,i.useEffect)(()=>{navigator.geolocation?(console.log("[Location] Requesting user location..."),navigator.geolocation.getCurrentPosition(e=>{r({lat:e.coords.latitude,lng:e.coords.longitude}),console.log("[Location] User location obtained:",e.coords.latitude,e.coords.longitude)},e=>{console.error("[Location] Error getting location:",e.message),o(e.message),r({lat:37.0965,lng:-113.5684})},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})):(console.warn("[Location] Geolocation not supported"),o("Geolocation not supported"),r({lat:37.0965,lng:-113.5684}))},[]),t)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"Nexus Nosh - Smart Dining for Business and Beyond"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("meta",{name:"description",content:"Personalized lunch-pairing and restaurant-recommendation experience"})]}),(0,s.jsx)("main",{children:(0,s.jsx)(L,{userId:t.uid,userName:t.displayName||(null===(e=t.email)||void 0===e?void 0:e.split("@")[0])||"User",userLocation:a})})]}):null}function _(){return(0,s.jsx)(q.Z,{children:(0,s.jsx)(G,{})})}},1526:function(e,t,a){"use strict";a.d(t,{M:function(){return p}});var s=a(7294),r=a(8868);function n(){let e=(0,s.useRef)(!1);return(0,r.L)(()=>(e.current=!0,()=>{e.current=!1}),[]),e}var i=a(6166),l=a(240),o=a(6681);class c extends s.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:t}){let a=(0,s.useId)(),r=(0,s.useRef)(null),n=(0,s.useRef)({width:0,height:0,top:0,left:0});return(0,s.useInsertionEffect)(()=>{let{width:e,height:s,top:i,left:l}=n.current;if(t||!r.current||!e||!s)return;r.current.dataset.motionPopId=a;let o=document.createElement("style");return document.head.appendChild(o),o.sheet&&o.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${s}px !important;
            top: ${i}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(o)}},[t]),s.createElement(c,{isPresent:t,childRef:r,sizeRef:n},s.cloneElement(e,{ref:r}))}let u=({children:e,initial:t,isPresent:a,onExitComplete:r,custom:n,presenceAffectsLayout:i,mode:c})=>{let u=(0,o.h)(m),h=(0,s.useId)(),x=(0,s.useMemo)(()=>({id:h,initial:t,isPresent:a,custom:n,onExitComplete:e=>{for(let t of(u.set(e,!0),u.values()))if(!t)return;r&&r()},register:e=>(u.set(e,!1),()=>u.delete(e))}),i?void 0:[a]);return(0,s.useMemo)(()=>{u.forEach((e,t)=>u.set(t,!1))},[a]),s.useEffect(()=>{a||u.size||!r||r()},[a]),"popLayout"===c&&(e=s.createElement(d,{isPresent:a},e)),s.createElement(l.O.Provider,{value:x},e)};function m(){return new Map}var h=a(5364),x=a(5487);let g=e=>e.key||"",p=({children:e,custom:t,initial:a=!0,onExitComplete:l,exitBeforeEnter:o,presenceAffectsLayout:c=!0,mode:d="sync"})=>{var m;(0,x.k)(!o,"Replace exitBeforeEnter with mode='wait'");let p=(0,s.useContext)(h.p).forceRender||function(){let e=n(),[t,a]=(0,s.useState)(0),r=(0,s.useCallback)(()=>{e.current&&a(t+1)},[t]);return[(0,s.useCallback)(()=>i.Wi.postRender(r),[r]),t]}()[0],f=n(),v=function(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}(e),y=v,b=(0,s.useRef)(new Map).current,j=(0,s.useRef)(y),w=(0,s.useRef)(new Map).current,N=(0,s.useRef)(!0);if((0,r.L)(()=>{N.current=!1,function(e,t){e.forEach(e=>{let a=g(e);t.set(a,e)})}(v,w),j.current=y}),m=()=>{N.current=!0,w.clear(),b.clear()},(0,s.useEffect)(()=>()=>m(),[]),N.current)return s.createElement(s.Fragment,null,y.map(e=>s.createElement(u,{key:g(e),isPresent:!0,initial:!!a&&void 0,presenceAffectsLayout:c,mode:d},e)));y=[...y];let k=j.current.map(g),P=v.map(g),M=k.length;for(let e=0;e<M;e++){let t=k[e];-1!==P.indexOf(t)||b.has(t)||b.set(t,void 0)}return"wait"===d&&b.size&&(y=[]),b.forEach((e,a)=>{if(-1!==P.indexOf(a))return;let r=w.get(a);if(!r)return;let n=k.indexOf(a),i=e;i||(i=s.createElement(u,{key:g(r),isPresent:!1,onExitComplete:()=>{b.delete(a);let e=Array.from(w.keys()).filter(e=>!P.includes(e));if(e.forEach(e=>w.delete(e)),j.current=v.filter(t=>{let s=g(t);return s===a||e.includes(s)}),!b.size){if(!1===f.current)return;p(),l&&l()}},custom:t,presenceAffectsLayout:c,mode:d},r),b.set(a,i)),y.splice(n,0,i)}),y=y.map(e=>{let t=e.key;return b.has(t)?e:s.createElement(u,{key:g(e),isPresent:!0,presenceAffectsLayout:c,mode:d},e)}),s.createElement(s.Fragment,null,b.size?y:y.map(e=>(0,s.cloneElement)(e)))}}},function(e){e.O(0,[224,812,843,598,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);