(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[505],{921:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/verify-firebase",function(){return r(4690)}])},4212:function(e,t,r){"use strict";r.d(t,{VU:function(){return a},le:function(){return n}});var i=r(310),o=r(9724);let s="tasteProfiles";async function n(e){if(!i.Wn)return console.warn("Firebase not configured. Returning default profile."),{userId:e,preferences:{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},learningData:{totalRatings:0,averageRating:0,lastUpdated:new Date}};try{let t=(0,i.xI)(),r=(0,o.JU)(t,s,e),n=await (0,o.QT)(r);if(n.exists())return n.data();let a={userId:e,preferences:{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},learningData:{totalRatings:0,averageRating:0,lastUpdated:new Date}};return await (0,o.pl)(r,a),a}catch(e){return console.error("Error getting taste profile:",e),null}}async function a(e,t){if(console.log("[updateTasteProfile] Starting...",{userId:e,preferences:t}),!i.Wn)throw console.error("[updateTasteProfile] Firebase not configured!"),Error("Firebase is not configured");try{let n=(0,i.xI)(),a=(0,i.yL)(),l=(0,o.JU)(n,s,e);console.log("[updateTasteProfile] Document reference created:",l.path);let c=null;try{console.log("[updateTasteProfile] Attempting to read existing profile...");let e=await Promise.race([(0,o.QT)(l),new Promise((e,t)=>setTimeout(()=>t(Error("timeout")),2e3))]);e&&e.exists()?(c=e.data(),console.log("[updateTasteProfile] Found existing profile:",c)):console.log("[updateTasteProfile] No existing profile found")}catch(e){console.warn("[updateTasteProfile] Could not read existing profile (may be offline):",e.message)}let{Timestamp:d}=await Promise.resolve().then(r.bind(r,9724)),u={userId:e,preferences:{...(null==c?void 0:c.preferences)||{quietness:50,serviceQuality:50,healthiness:50,value:50,atmosphere:50,cuisineTypes:[],priceRange:{min:10,max:100}},...t},learningData:{...(null==c?void 0:c.learningData)||{totalRatings:0,averageRating:0},lastUpdated:d.now()}};if(!a||!a.currentUser)throw Error("User must be authenticated to save taste profile");console.log("[updateTasteProfile] User authenticated:",a.currentUser.uid),console.log("[updateTasteProfile] Saving data:",u),console.log("[updateTasteProfile] Attempting setDoc with merge..."),await Promise.race([(0,o.pl)(l,u,{merge:!0}),new Promise((e,t)=>setTimeout(()=>t(Error("Write operation timed out after 30 seconds")),3e4))]),console.log("[updateTasteProfile] ✓ Successfully saved to Firebase!")}catch(e){var n;if(console.error("[updateTasteProfile] ✗ Full error object:",e),console.error("[updateTasteProfile] ✗ Error as JSON:",JSON.stringify(e,Object.getOwnPropertyNames(e),2)),console.error("[updateTasteProfile] ✗ Error details:",{message:e.message,code:e.code,serverResponse:e.serverResponse,name:e.name,stack:null===(n=e.stack)||void 0===n?void 0:n.substring(0,500)}),"permission-denied"===e.code||"PERMISSION_DENIED"===e.code)throw Error("Permission denied. Please ensure you are logged in and have permission to save this data.");if("unauthenticated"===e.code||"UNAUTHENTICATED"===e.code)throw Error("Authentication required. Please sign in and try again.");if("invalid-argument"===e.code||"INVALID_ARGUMENT"===e.code)throw Error("Invalid data format. Please check the data being saved.");if("unavailable"===e.code||"UNAVAILABLE"===e.code)throw Error("Firestore is currently unavailable. Please try again in a moment.");else if(e.message&&e.message.includes("timed out"))throw console.warn("[updateTasteProfile] Write timed out - may complete in background if online"),Error("Save operation timed out. Please check your connection and try again.");throw Error("Failed to save: ".concat(e.message||e.code||"Unknown error"))}}},6466:function(e,t,r){"use strict";r.d(t,{lU:function(){return a},nS:function(){return n},vU:function(){return l}});var i=r(310),o=r(9724);let s="userSettings";async function n(e){if(!i.Wn)return console.warn("Firebase not configured. Returning default settings."),{userId:e,notifications:{emailNotifications:!0,pushNotifications:!0,friendRecommendations:!0,meetingReminders:!0},viewPreferences:{restaurantsListView:!1},updatedAt:new Date};try{let t=(0,i.xI)(),r=(0,o.JU)(t,s,e),n=await (0,o.QT)(r);if(n.exists())return n.data();let a={userId:e,notifications:{emailNotifications:!0,pushNotifications:!0,friendRecommendations:!0,meetingReminders:!0},viewPreferences:{restaurantsListView:!1},updatedAt:new Date};return await (0,o.pl)(r,a),a}catch(e){return console.error("Error getting user settings:",e),null}}async function a(e,t){var n,a,l;if(console.log("[updateNotificationSettings] Starting...",{userId:e,notifications:t}),!i.Wn)throw console.error("[updateNotificationSettings] Firebase not configured!"),Error("Firebase is not configured");try{let l=(0,i.xI)(),c=(0,i.yL)(),d=(0,o.JU)(l,s,e);console.log("[updateNotificationSettings] Document reference created:",d.path);let u=null;try{console.log("[updateNotificationSettings] Attempting to read existing settings...");let e=await Promise.race([(0,o.QT)(d),new Promise((e,t)=>setTimeout(()=>t(Error("timeout")),2e3))]);e&&e.exists()?(u=e.data(),console.log("[updateNotificationSettings] Found existing settings:",u)):console.log("[updateNotificationSettings] No existing settings found")}catch(e){console.warn("[updateNotificationSettings] Could not read existing settings (may be offline):",e.message)}let{Timestamp:f}=await Promise.resolve().then(r.bind(r,9724)),g={userId:e,notifications:{emailNotifications:!0,pushNotifications:!0,friendRecommendations:!0,meetingReminders:!0,...(null==u?void 0:u.notifications)||{},...t},viewPreferences:{restaurantsListView:null!==(a=null==u?void 0:null===(n=u.viewPreferences)||void 0===n?void 0:n.restaurantsListView)&&void 0!==a&&a},updatedAt:f.now()};if(!c||!c.currentUser)throw Error("User must be authenticated to save settings");console.log("[updateNotificationSettings] User authenticated:",c.currentUser.uid),console.log("[updateNotificationSettings] Saving data:",g),console.log("[updateNotificationSettings] Attempting setDoc with merge..."),await Promise.race([(0,o.pl)(d,g,{merge:!0}),new Promise((e,t)=>setTimeout(()=>t(Error("Write operation timed out after 30 seconds")),3e4))]),console.log("[updateNotificationSettings] ✓ Successfully saved to Firebase!")}catch(e){if(console.error("[updateNotificationSettings] ✗ Full error object:",e),console.error("[updateNotificationSettings] ✗ Error as JSON:",JSON.stringify(e,Object.getOwnPropertyNames(e),2)),console.error("[updateNotificationSettings] ✗ Error details:",{message:e.message,code:e.code,serverResponse:e.serverResponse,name:e.name,stack:null===(l=e.stack)||void 0===l?void 0:l.substring(0,500)}),"permission-denied"===e.code||"PERMISSION_DENIED"===e.code)throw Error("Permission denied. Please ensure you are logged in and have permission to save this data.");if("unauthenticated"===e.code||"UNAUTHENTICATED"===e.code)throw Error("Authentication required. Please sign in and try again.");if("invalid-argument"===e.code||"INVALID_ARGUMENT"===e.code)throw Error("Invalid data format. Please check the data being saved.");if("unavailable"===e.code||"UNAVAILABLE"===e.code)throw Error("Firestore is currently unavailable. Please try again in a moment.");else if(e.message&&e.message.includes("timed out"))throw console.warn("[updateNotificationSettings] Write timed out - may complete in background if online"),Error("Save operation timed out. Please check your connection and try again.");throw Error("Failed to save: ".concat(e.message||e.code||"Unknown error"))}}async function l(e,t){if(console.log("[updateViewPreferences] Starting...",{userId:e,viewPreferences:t}),!i.Wn)throw console.error("[updateViewPreferences] Firebase not configured!"),Error("Firebase is not configured");try{var n,a,l;let c=(0,i.xI)(),d=(0,i.yL)(),u=(0,o.JU)(c,s,e),f=await (0,o.QT)(u),g=f.exists()?f.data():null,{Timestamp:m}=await Promise.resolve().then(r.bind(r,9724)),p={restaurantsListView:null!==(a=null==g?void 0:null===(n=g.viewPreferences)||void 0===n?void 0:n.restaurantsListView)&&void 0!==a&&a,...t},h={userId:e,notifications:null!==(l=null==g?void 0:g.notifications)&&void 0!==l?l:{emailNotifications:!0,pushNotifications:!0,friendRecommendations:!0,meetingReminders:!0},viewPreferences:p,updatedAt:m.now()};if(!d||!d.currentUser)throw Error("User must be authenticated to save view preferences");await (0,o.pl)(u,h,{merge:!0}),console.log("[updateViewPreferences] ✓ Successfully saved view preferences!")}catch(e){throw console.error("[updateViewPreferences] ✗ Failed to save view preferences:",e),e}}},4690:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var i=r(5893),o=r(7294),s=r(9008),n=r.n(s),a=r(4212),l=r(6466),c=r(9724),d=r(310);function u(){let[e,t]=(0,o.useState)(null),[r,s]=(0,o.useState)(null),[u,f]=(0,o.useState)(!0),[g,m]=(0,o.useState)(null);async function p(){f(!0),m(null);try{let e="demo-user-123",[r,i]=await Promise.all([(0,a.le)(e),(0,l.nS)(e)]);if(t(r),s(i),d.db)try{let t=(0,c.JU)(d.db,"tasteProfiles",e),r=await (0,c.QT)(t);console.log("Direct Firestore read - Taste Profile exists:",r.exists()),r.exists()&&console.log("Direct Firestore data:",r.data());let i=(0,c.JU)(d.db,"userSettings",e),o=await (0,c.QT)(i);console.log("Direct Firestore read - User Settings exists:",o.exists()),o.exists()&&console.log("Direct Firestore data:",o.data())}catch(e){console.error("Direct Firestore read error:",e)}}catch(e){m(e.message),console.error("Error loading data:",e)}finally{f(!1)}}return(0,o.useEffect)(()=>{p()},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n(),{children:(0,i.jsx)("title",{children:"Verify Firebase Data - Nexus Nosh"})}),(0,i.jsxs)("div",{className:"p-8 max-w-4xl mx-auto",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Firebase Data Verification"}),(0,i.jsx)("button",{onClick:p,className:"mb-4 px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:"Refresh Data"}),u&&(0,i.jsx)("p",{children:"Loading..."}),g&&(0,i.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:["Error: ",g]}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Taste Profile"}),e?(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-green-600 mb-2",children:"✓ Data found"}),(0,i.jsx)("pre",{className:"bg-gray-100 p-4 rounded overflow-auto text-sm",children:JSON.stringify(e,null,2)})]}):(0,i.jsx)("p",{className:"text-red-600",children:"✗ No data found"})]}),(0,i.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"User Settings"}),r?(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-green-600 mb-2",children:"✓ Data found"}),(0,i.jsx)("pre",{className:"bg-gray-100 p-4 rounded overflow-auto text-sm",children:JSON.stringify(r,null,2)})]}):(0,i.jsx)("p",{className:"text-red-600",children:"✗ No data found"})]})]}),(0,i.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded",children:[(0,i.jsx)("p",{className:"font-semibold mb-2",children:"Check Browser Console:"}),(0,i.jsx)("p",{className:"text-sm",children:"Open DevTools (F12) → Console tab to see direct Firestore read results"})]}),(0,i.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded",children:[(0,i.jsx)("p",{className:"font-semibold mb-2",children:"Firebase Console:"}),(0,i.jsx)("a",{href:"https://console.firebase.google.com/project/nexus-nosh/firestore",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"Open Firebase Console"}),(0,i.jsxs)("p",{className:"text-sm mt-2",children:["Look for collections: ",(0,i.jsx)("code",{children:"tasteProfiles"})," and ",(0,i.jsx)("code",{children:"userSettings"})]}),(0,i.jsxs)("p",{className:"text-sm",children:["Document ID: ",(0,i.jsx)("code",{children:"demo-user-123"})]})]})]})]})}},9008:function(e,t,r){e.exports=r(7828)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=921)}),_N_E=e.O()}]);