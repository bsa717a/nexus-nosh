"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{6510:function(e,t,r){r.d(t,{Z:function(){return h}});var a=r(5893),n=r(1163),s=r(8370),i=r(9455),o=r(1692),l=r(7963),d=r(718),u=r(1565),c=r(3696),f=r(6442);let m=[{href:"/",icon:s.Z,label:"Home"},{href:"/restaurants",icon:i.Z,label:"Restaurants"},{href:"/my-list",icon:o.Z,label:"My List"},{href:"/friends",icon:l.Z,label:"Friends"},{href:"/profile",icon:d.Z,label:"Profile"},{href:"/settings",icon:u.Z,label:"Settings"}];function h(){let e=(0,n.useRouter)(),{signOut:t}=(0,f.a)(),r=e.pathname,s=async()=>{try{await t(),e.push("/login")}catch(e){console.error("Error signing out:",e)}};return(0,a.jsx)("nav",{className:"fixed bottom-0 inset-x-0 z-50",children:(0,a.jsx)("div",{className:"bg-white/80 backdrop-blur-xl border-t border-gray-200/50 shadow-[0_-4px_20px_rgba(0,0,0,0.08)]",children:(0,a.jsx)("div",{className:"max-w-xl mx-auto px-4 py-2",children:(0,a.jsxs)("div",{className:"flex justify-around items-center",children:[m.map(t=>{let{href:n,icon:s,label:i}=t,o=r===n;return(0,a.jsxs)("button",{onClick:()=>e.push(n),className:"flex flex-col items-center py-2 px-3 group",children:[(0,a.jsx)("div",{className:"p-2 rounded-2xl transition-all duration-200 ".concat(o?"bg-orange-500 text-white shadow-lg shadow-orange-500/30":"text-gray-400 group-hover:text-orange-500 group-hover:bg-orange-50"),children:(0,a.jsx)(s,{className:"w-5 h-5"})}),(0,a.jsx)("span",{className:"text-xs font-medium mt-1 transition-colors ".concat(o?"text-orange-600":"text-gray-400 group-hover:text-orange-500"),children:i})]},n)}),(0,a.jsxs)("button",{onClick:s,className:"flex flex-col items-center py-2 px-3 group",children:[(0,a.jsx)("div",{className:"p-2 rounded-2xl text-gray-400 group-hover:text-red-500 group-hover:bg-red-50 transition-all duration-200",children:(0,a.jsx)(c.Z,{className:"w-5 h-5"})}),(0,a.jsx)("span",{className:"text-xs font-medium text-gray-400 group-hover:text-red-500 mt-1 transition-colors",children:"Sign Out"})]})]})})})})}},5993:function(e,t,r){r.d(t,{Z:function(){return o}});var a=r(5893),n=r(7294),s=r(1163),i=r(6442);function o(e){let{children:t}=e,{user:r,loading:o}=(0,i.a)(),l=(0,s.useRouter)(),[d,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{o||r||d||(u(!0),l.push("/login"))},[r,o,l,d]),o)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-orange-50 to-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):r?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-b from-orange-50 to-white flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Redirecting to login..."})]})})}},3949:function(e,t,r){r.d(t,{$J:function(){return l},C3:function(){return p},K0:function(){return m},MC:function(){return x},ND:function(){return u},VH:function(){return g},iN:function(){return d},k7:function(){return f},kV:function(){return h},tJ:function(){return c}});var a=r(310),n=r(9724);let s="users",i="userLists",o="userRestaurants";async function l(e){try{let t=(0,a.xI)(),r=(0,n.hJ)(t,s,e,"friends"),i=(0,n.IO)(r,(0,n.Xo)("invitedAt","desc"));return(await (0,n.PL)(i)).docs.map(e=>{var t,r;return{id:e.id,...e.data(),invitedAt:null===(t=e.data().invitedAt)||void 0===t?void 0:t.toDate(),connectedAt:null===(r=e.data().connectedAt)||void 0===r?void 0:r.toDate()}})}catch(e){return console.error("Error getting friends:",e),[]}}async function d(e,t,r,i){let o=(0,a.xI)(),l=(0,n.hJ)(o,s,e,"friends"),d=(0,n.IO)(l,(0,n.ar)("email","==",i)),u=await (0,n.PL)(d);if(!u.empty){let e=u.docs[0].data().status;if("accepted"===e)throw Error("Already friends!");if("requested_outgoing"===e)throw Error("Request already sent");if("requested_incoming"===e)throw Error("They already sent you a request! Check your list.");throw Error("Friend already invited")}let c=(0,n.hJ)(o,s);console.log("[inviteFriendByEmail] Searching for:",i);let f=(0,n.IO)(c,(0,n.ar)("email","==",i)),m=await (0,n.PL)(f);if(console.log("[inviteFriendByEmail] Exact match results:",m.size),m.empty&&(f=(0,n.IO)(c,(0,n.ar)("emailLowerCase","==",i.toLowerCase())),console.log("[inviteFriendByEmail] Lowercase field match results:",(m=await (0,n.PL)(f)).size)),m.empty&&(f=(0,n.IO)(c,(0,n.ar)("email","==",i.toLowerCase())),console.log("[inviteFriendByEmail] Email lowercase value match results:",(m=await (0,n.PL)(f)).size)),m.empty){let e=await (0,n.PL)(c);console.log("[inviteFriendByEmail] All users in collection:"),e.forEach(e=>{let t=e.data();console.log("  - ".concat(e.id,": ").concat(t.email))})}if(!m.empty){let a=m.docs[0],d=a.id,u=a.data();if(d===e)throw Error("You can't add yourself!");let c=(0,n.JU)(l,d);await (0,n.pl)(c,{id:d,userId:d,email:i,displayName:u.displayName||i.split("@")[0],photoURL:u.photoURL||null,status:"requested_outgoing",invitedAt:(0,n.Bt)()});let f=(0,n.JU)(o,s,d,"friends",e);return await (0,n.pl)(f,{id:e,userId:e,email:t,displayName:r||t.split("@")[0],status:"requested_incoming",invitedAt:(0,n.Bt)()}),{found:!0,friendName:u.displayName}}let h=(0,n.JU)(l);return await (0,n.pl)(h,{id:h.id,email:i,displayName:i.split("@")[0],status:"pending",invitedAt:(0,n.Bt)()}),{found:!1}}async function u(e,t){let r=(0,a.xI)(),i=(0,n.JU)(r,s,e,"friends",t);await (0,n.pl)(i,{status:"accepted",connectedAt:(0,n.Bt)()},{merge:!0});let o=(0,n.JU)(r,s,t,"friends",e);await (0,n.pl)(o,{status:"accepted",connectedAt:(0,n.Bt)()},{merge:!0})}async function c(e,t){let r=(0,a.xI)(),i=(0,n.JU)(r,s,e,"friends",t);await (0,n.oe)(i)}function f(e){return{title:"Join me on Nexus Nosh",text:"Hey! I've been using Nexus Nosh to find great places to eat. Check out my restaurant list:",url:"".concat(window.location.origin,"/login?ref=").concat(encodeURIComponent(e))}}async function m(e){try{var t;let r=(0,a.xI)(),i=(0,n.JU)(r,s,e),o=await (0,n.QT)(i);if(!o.exists())return null;let l=o.data();return{id:o.id,displayName:l.displayName||(null===(t=l.email)||void 0===t?void 0:t.split("@")[0])||"Unknown",email:l.email||"",photoURL:l.photoURL}}catch(e){return console.error("Error getting friend profile:",e),null}}async function h(e){try{let t=(0,a.xI)(),r=(0,n.IO)((0,n.hJ)(t,i),(0,n.ar)("userId","==",e)),s=await (0,n.PL)(r),o=[];for(let e of s.docs){let t=e.data();t.restaurantName&&t.restaurantAddress&&t.restaurantCoordinates&&o.push({id:t.restaurantId,name:t.restaurantName,address:t.restaurantAddress,coordinates:t.restaurantCoordinates,cuisineType:t.restaurantCuisineType||[],source:t.restaurantId.startsWith("mapbox-")?"mapbox":"database"})}return o}catch(e){return console.error("Error getting friend restaurants:",e),[]}}async function p(e){try{let t=(0,a.xI)(),r=(0,n.IO)((0,n.hJ)(t,o),(0,n.ar)("userId","==",e)),s=await (0,n.PL)(r),i={};return s.forEach(e=>{var t,r;let a=e.data();i[a.restaurantId]={userId:a.userId,restaurantId:a.restaurantId,wantToGo:null!==(t=a.wantToGo)&&void 0!==t&&t,hasBeen:null!==(r=a.hasBeen)&&void 0!==r&&r,personalRating:a.personalRating,notes:a.notes,zipCode:a.zipCode,updatedAt:a.updatedAt}}),i}catch(e){return console.error("Error getting friend restaurant states:",e),{}}}async function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;try{let l=(0,a.xI)(),d=(0,n.hJ)(l,s,e,"friends"),u=(await (0,n.PL)(d)).docs.map(e=>({id:e.id,...e.data()})).filter(e=>"accepted"===e.status&&e.userId);if(0===u.length)return[];let c=[];for(let e of u){var r;let t=e.userId,a=e.displayName||(null===(r=e.email)||void 0===r?void 0:r.split("@")[0])||"A friend",s=(0,n.IO)((0,n.hJ)(l,o),(0,n.ar)("userId","==",t)),d=(await (0,n.PL)(s)).docs.map(e=>e.data()).filter(e=>e.personalRating&&e.personalRating>=4);if(0===d.length)continue;let u=(0,n.IO)((0,n.hJ)(l,i),(0,n.ar)("userId","==",t)),f=await (0,n.PL)(u),m=new Map;for(let e of(f.docs.forEach(e=>{let t=e.data();t.restaurantName&&t.restaurantAddress&&t.restaurantCoordinates&&m.set(t.restaurantId,{id:t.restaurantId,name:t.restaurantName,address:t.restaurantAddress,coordinates:t.restaurantCoordinates,cuisineType:t.restaurantCuisineType||[],source:t.restaurantId.startsWith("mapbox-")?"mapbox":"database"})}),d)){let r=m.get(e.restaurantId);r&&c.push({restaurant:r,friendName:a,friendId:t,rating:e.personalRating})}}return c.sort(()=>Math.random()-.5).slice(0,t)}catch(e){return console.error("Error getting friends highly rated restaurants:",e),[]}}async function x(e){try{let t=(0,a.xI)(),r=(0,n.hJ)(t,s,e,"friends"),o=(await (0,n.PL)(r)).docs.map(e=>({id:e.id,...e.data()})).filter(e=>"accepted"===e.status&&e.userId);if(0===o.length)return[];let l=new Set;for(let e of o){let r=e.userId,a=(0,n.IO)((0,n.hJ)(t,i),(0,n.ar)("userId","==",r));(await (0,n.PL)(a)).docs.forEach(e=>{let t=e.data();t.restaurantId&&l.add(t.restaurantId)})}return Array.from(l)}catch(e){return console.error("Error getting friends restaurant IDs:",e),[]}}}}]);