# Mapbox Restaurant Search Integration

## Overview

Nexus Nosh now uses **Mapbox Search Box API** to discover restaurants near your location. This provides access to millions of real restaurants worldwide from OpenStreetMap data - completely free for up to 100,000 requests per month!

## How It Works

### 1. Restaurant Discovery
- Uses your **existing Mapbox token** (no additional API key needed!)
- Searches for restaurants within a specified radius (default: 10km)
- Returns up to 50 restaurants per search
- Sorted by distance from your location

### 2. Data Retrieved
From Mapbox, we get:
- âœ… Restaurant name
- âœ… Full address with coordinates
- âœ… Cuisine categories (when available)
- âœ… Distance from search center

What Mapbox doesn't provide (that's where YOU come in!):
- âŒ Ratings â†’ **Users add their own ratings**
- âŒ Reviews â†’ **Users add personal notes**
- âŒ Photos â†’ **Can be added later**
- âŒ Price range â†’ **Users can update**

### 3. User-Generated Value
This approach gives you several advantages:
- ğŸ¯ **Your own rating system** - more valuable than external ratings
- ğŸ’° **No API costs** - 100,000 free searches/month
- ğŸ”’ **Own your data** - build a proprietary database
- ğŸš€ **Competitive advantage** - unique, personalized insights

## Implementation Details

### Files Created
- **`lib/services/mapbox/mapboxSearchService.ts`** - Main search service
  - `searchMapboxRestaurants()` - Find restaurants near a location
  - `getMapboxPlaceDetails()` - Get details for a specific place (future use)

### Files Updated
- **`components/Dashboard.tsx`** - Uses Mapbox search instead of Yelp
- **`components/MapView.tsx`** - Shows Mapbox restaurants with green markers
  - Green markers = Mapbox restaurants
  - Orange markers = Your database restaurants

## API Limits & Pricing

### Free Tier (What You're Using)
- **100,000 requests per month** - FREE forever
- Automatically resets each month
- No credit card required
- Uses your existing Mapbox token

### Usage Estimates
- If each user searches 10 times/day = **10,000 daily active users**
- If each user searches 50 times/day = **2,000 daily active users**
- More than enough for MVP â†’ Series A â†’ Series B!

### If You Exceed (unlikely)
- **$0.60 per 1,000 requests** after 100,000
- Still very affordable compared to alternatives

## How to Use

### On the Dashboard

1. **Toggle Button**: "All Restaurants" / "My Restaurants"
   - **All Restaurants** - Shows both Mapbox discoveries + your database
   - **My Restaurants** - Shows only restaurants you've saved

2. **ZIP Code Filter**
   - Enter a ZIP code to filter restaurants in that area

3. **"Near Me" Button**
   - Detects your current location
   - Shows restaurants closest to you

4. **Map Legend**
   - ğŸŸ¢ Green markers = Mapbox restaurants (newly discovered)
   - ğŸŸ  Orange markers = Your database restaurants (saved)

### Adding Restaurants to Your Database

When a user finds a Mapbox restaurant they like:
1. Click the restaurant marker on the map
2. View restaurant details
3. Go to the "Restaurants" page
4. Add personal ratings, notes, and tags
5. It's now saved to YOUR database!

## Technical Notes

### Restaurant IDs
- Mapbox restaurants: `mapbox-{mapbox_id}`
- Database restaurants: Generated by Firestore
- This prevents ID conflicts

### Data Conversion
Mapbox data is converted to your `Restaurant` type:
```typescript
{
  id: `mapbox-${mapboxId}`,
  name: string,
  address: string,
  coordinates: { lat, lng },
  cuisineType: string[], // From Mapbox categories
  rating: { average: 0, count: 0 }, // Users will add!
  priceRange: { min: 10, max: 30 }, // Default, users update
  attributes: {
    quietness: 50, // Default, users rate
    serviceSpeed: 'medium',
    atmosphere: 'casual',
    // ... more defaults
  }
}
```

### Distance Calculation
- Uses **Haversine formula** for accurate distance
- Filters results by radius
- Sorts by proximity to user location

## API Documentation

- **Mapbox Search Box API**: https://docs.mapbox.com/api/search/search-box/
- **Category Search**: https://docs.mapbox.com/api/search/search-box/#category-search
- **OpenStreetMap**: https://www.openstreetmap.org/ (data source)

## Future Enhancements

### Short Term
- [ ] Cache Mapbox results to reduce API calls
- [ ] Add "Save Restaurant" button on map popups
- [ ] Show which Mapbox restaurants are already in your database

### Medium Term
- [ ] Auto-save popular Mapbox restaurants to your database
- [ ] Batch geocoding for existing database restaurants
- [ ] Add photos from users or other sources

### Long Term
- [ ] ML model to predict restaurant attributes from OSM data
- [ ] Community-sourced ratings aggregation
- [ ] Integration with calendar for meeting location suggestions

## Comparison: Mapbox vs Alternatives

| Feature | Mapbox (Your Solution) | Yelp | Google Places |
|---------|----------------------|------|---------------|
| **Monthly Free** | 100,000 | 5,000 (trial only) | ~28,000 |
| **After Free** | $0.60/1k | $229-643/month | $7/1k |
| **Ratings** | âŒ User-generated âœ¨ | âœ… External | âœ… External |
| **Data Ownership** | âœ… You own it | âŒ Rented | âŒ Rented |
| **Setup** | âœ… Same token | Credit card | Billing account |
| **Best For** | ğŸš€ Startups/MVPs | Enterprise | Medium-Large |

## Testing

### Browser Console Logs
Watch for these logs to verify it's working:
```
[Dashboard] Loading Mapbox restaurants near: { lat: ..., lng: ... }
[MapboxSearch] Searching restaurants near: ...
[MapboxSearch] Received features: XX
[MapboxSearch] Converted to restaurants: XX
[Dashboard] Mapbox restaurants loaded: XX
[Dashboard] Combined restaurants: { db: X, mapbox: XX, total: XXX }
```

### Visual Confirmation
- ğŸŸ¢ Green markers = Mapbox working!
- ğŸŸ  Orange markers = Your database
- Click markers to see restaurant details
- Toggle button switches between all/database only

## Troubleshooting

### "No restaurants found"
1. Check that your location is being detected
2. Try clicking "Near Me" button
3. Try entering a ZIP code
4. Check console for API errors

### "Map not loading"
1. Verify `NEXT_PUBLIC_MAPBOX_TOKEN` is set
2. Check that token is valid at https://account.mapbox.com/
3. Restart dev server after adding token

### Mapbox API errors
- **401 Unauthorized**: Invalid token
- **429 Too Many Requests**: Exceeded free tier (very unlikely)
- **400 Bad Request**: Invalid coordinates or parameters

## Success Metrics

Track these to measure success:
- Number of Mapbox restaurants discovered
- Conversion rate: Mapbox â†’ Database
- User engagement with rating/notes features
- API usage vs. free tier limit

---

## Summary

âœ… **No additional API keys needed** - uses your existing Mapbox token  
âœ… **100,000 free searches/month** - more than enough for startup scale  
âœ… **Build proprietary data** - your ratings > external ratings  
âœ… **Already integrated** - working in your app now!  

Just allow location access, and start discovering restaurants! ğŸ‰

