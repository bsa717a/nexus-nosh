steps:
  # Install dependencies
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['ci']
  
  # Build the Next.js app with environment variables
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['run', 'build']
    env:
      - 'NEXT_PUBLIC_FIREBASE_API_KEY=${_FIREBASE_API_KEY}'
      - 'NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=${_FIREBASE_AUTH_DOMAIN}'
      - 'NEXT_PUBLIC_FIREBASE_PROJECT_ID=${_FIREBASE_PROJECT_ID}'
      - 'NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=${_FIREBASE_STORAGE_BUCKET}'
      - 'NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=${_FIREBASE_MESSAGING_SENDER_ID}'
      - 'NEXT_PUBLIC_FIREBASE_APP_ID=${_FIREBASE_APP_ID}'
      - 'NEXT_PUBLIC_MAPBOX_TOKEN=${_MAPBOX_TOKEN}'
  
  # Deploy to App Engine
  - name: 'gcr.io/cloud-builders/gcloud'
    args:
      - 'app'
      - 'deploy'
      - '--quiet'

substitutions:
  _FIREBASE_API_KEY: 'AIzaSyBwDU2LlhEXIzB5iw4zhq_uepf2K4skPSc'
  _FIREBASE_AUTH_DOMAIN: 'nexus-nosh.firebaseapp.com'
  _FIREBASE_PROJECT_ID: 'nexus-nosh'
  _FIREBASE_STORAGE_BUCKET: 'nexus-nosh.firebasestorage.app'
  _FIREBASE_MESSAGING_SENDER_ID: '251223233015'
  _FIREBASE_APP_ID: '1:251223233015:web:26460b83dd6a21f5ce1ef2'
  _MAPBOX_TOKEN: 'pk.eyJ1IjoiYnNhNzE3IiwiYSI6ImNtaG13YnZvczIxcHIybXB1N2E0NnJpcHcifQ.Z-AeF3-pt2ihl2uz71Lvxg'

options:
  logging: CLOUD_LOGGING_ONLY

